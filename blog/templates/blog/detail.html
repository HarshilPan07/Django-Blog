{% extends 'blog/base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class='card m-3'>
    <h5 class='card-header'>
        {{ post.title }}
        <div class='row'>
            <div class='col'>
                <small>Posted {{ post.date_posted }} by <a href="{% url 'view-profile' post.author.pk %}">{{ post.author }}</a></small>
            </div>
        </div>
    </h5>
    <div class='card-body'>
        <p>{{ post.content }}</p>
    </div>
    <div class='card-footer'>   
        <div class='row'>
            <div class='col-10'>
                <a href="{% url 'like-post' post.id %}">
                    <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-arrow-up-short" fill="#F73009" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"/>
                    </svg>
                </a>
                {{ post.get_rating }}
                <a href="{% url 'dislike-post' post.id %}"> 
                    <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-arrow-down-short" fill="#8283F6" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"/>
                    </svg>
                </a> 
            </div>
            <div class='col-2'>
                {% if user == post.author %}
                <small><a href="{% url 'update-post' post.id %}">Edit Post |</a></small>
                <small><a href="{% url 'delete-post' post.id %}">| Delete Post</a></small>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div>
    <div>
        <form action="#" method="POST">
            {% csrf_token %}
            {{ comment_form | crispy }}
            <button class='btn btn-primary d-flex justify-content-end' type="submit">Add Comment</button>
        </form>
    </div>
    <h5 class='pt-3'>Comments</h5>
    <hr>
    {% if post.comment_set.all %}
        <div class='list-group py-3'>
            <ul class='list-group list-group-flush'>
                {% for comment in post.comment_set.all %}
                <li class='list-group-item'>
                    <div>
                        <h5>{{ comment.content}}</h5>
                        <small>
                            <a href="{% url 'like-comment' post_pk=post.id comment_pk=comment.id %}">
                                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-arrow-up-short" fill="#F73009" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"/>
                                </svg>
                            </a>
                            {{ comment.get_rating }}
                            <a href="{% url 'dislike-comment' post_pk=post.id comment_pk=comment.id %}"> 
                                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-arrow-down-short" fill="#8283F6" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"/>
                                </svg>
                            </a> 
                        </small>
                        <small>Posted by {{ comment.commenter }} | {{ comment.date_posted }}</small>
                        <!-- <small><a href="{% url 'like-comment' post_pk=post.id comment_pk=comment.id %}">Like: </a>{{ comment.likes.count }}</small>
                        <small><a href="{% url 'dislike-comment' post_pk=post.id comment_pk=comment.id %}">Dislike: </a>{{ comment.dislikes.count }}</small> -->
                    </div>
                </li>
                {% endfor %}
            </ul>    
        </div>
    {% else %}
        <div class='jumbotron m-3'>
            <h3 class='display-4'>Looks like there aren't any comments here!</h3>
            <hr>
            <div>
                <small class='text-muted'>Click "Add Comment" above to add a new comment.</small>
            </div>
        </div>
    {% endif %}
</div>
{% endblock content %}